<div class="dashboard-container">
  <!-- Header Stats -->
  <div class="stats-grid">
    <div class="stat-card total">
      <div class="stat-icon">üñ®Ô∏è</div>
      <div class="stat-info">
        <h3>{{ dashboardStats.total }}</h3>
        <p>Total Printers</p>
      </div>
    </div>

    <div class="stat-card online">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-info">
        <h3>{{ dashboardStats.online }}</h3>
        <p>Online</p>
      </div>
    </div>

    <div class="stat-card offline">
      <div class="stat-icon">‚ùå</div>
      <div class="stat-info">
        <h3>{{ dashboardStats.offline }}</h3>
        <p>Offline</p>
      </div>
    </div>

    <div class="stat-card warning">
      <div class="stat-icon">‚ö†Ô∏è</div>
      <div class="stat-info">
        <h3>{{ dashboardStats.warning }}</h3>
        <p>Warning</p>
      </div>
    </div>

    <div class="stat-card laser">
      <div class="stat-icon">üñ§</div>
      <div class="stat-info">
        <h3>{{ dashboardStats.laser }}</h3>
        <p>Laser (Toner)</p>
      </div>
    </div>

    <div class="stat-card inkjet">
      <div class="stat-icon">üé®</div>
      <div class="stat-info">
        <h3>{{ dashboardStats.inkjet }}</h3>
        <p>Inkjet (Ink)</p>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="dashboard-content">
    <!-- Recent Alerts -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>Recent Alerts</h2>
        <button pButton pRipple class="btn-link" routerLink="/alerts">View All</button>
      </div>

      <div class="alerts-list" *ngIf="alerts.length > 0; else noAlerts">
        <div class="alert-item" *ngFor="let alert of alerts" [ngClass]="getSeverityClass(alert.severity)">
          <div class="alert-icon">‚ö†Ô∏è</div>
          <div class="alert-content">
            <h4>{{ alert.printerName }}</h4>
            <p>{{ alert.message }}</p>
            <small>{{ alert.createdAt | date:'short' }}</small>
          </div>
        </div>
      </div>

      <ng-template #noAlerts>
        <div class="no-data">
          <p>No recent alerts</p>
        </div>
      </ng-template>
    </div>

    <!-- Printer Status Overview -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>Printer Status</h2>
        <div class="header-actions">
          <button pButton pRipple class="btn-refresh" (click)="refreshNow()" title="Refresh SNMP Data">
            Refresh
          </button>
          <button pButton pRipple class="btn-link" routerLink="/printers">View All</button>
        </div>
      </div>

      <div class="printers-grid" *ngIf="printers.length > 0; else noPrinters">
        <!-- Added (click) handler -->
        <div class="printer-card" *ngFor="let printer of printers.slice(0, 6)"
          [ngClass]="getStatusClass(printer.status)"
          (click)="showPrinterDetails(printer)"
          style="cursor: pointer;"> 
          <div class="printer-header">
            <h4>{{ printer.name }}</h4>
            <span class="status-badge">{{ printer.status }}</span>
          </div>
          <div class="printer-info">
            <p><strong>Model:</strong> {{ printer.model }}</p>
            <p><strong>Location:</strong> {{ printer.location }}</p>
            <p><strong>IP:</strong> {{ printer.ipAddress }}</p>
          </div>
          <div class="printer-stats" *ngIf="printer.status === 'online'">
            <div class="stat" *ngIf="printer.printerType === 'laser'">
              <span>Toner:</span>
              <div class="progress-bar">
                <div class="progress toner" [style.width.%]="printer.tonerLevel || 0"></div>
              </div>
              <span>{{ printer.tonerLevel || 0 }}%</span>
            </div>
            <div class="ink-stats" *ngIf="printer.printerType === 'inkjet' && printer.inkLevels">
              <span>Ink:</span>
              <div class="ink-grid">
                <div class="mini-ink" *ngIf="printer.inkLevels.cyan !== undefined">
                  <div class="mini-bar cyan" [style.--width]="printer.inkLevels.cyan + '%'"></div>
                  <small>C: {{ printer.inkLevels.cyan }}%</small>
                </div>
                <div class="mini-ink" *ngIf="printer.inkLevels.magenta !== undefined">
                  <div class="mini-bar magenta" [style.--width]="printer.inkLevels.magenta + '%'"></div>
                  <small>M: {{ printer.inkLevels.magenta }}%</small>
                </div>
                <div class="mini-ink" *ngIf="printer.inkLevels.yellow !== undefined">
                  <div class="mini-bar yellow" [style.--width]="printer.inkLevels.yellow + '%'"></div>
                  <small>Y: {{ printer.inkLevels.yellow }}%</small>
                </div>
                <div class="mini-ink" *ngIf="printer.inkLevels.black !== undefined">
                  <div class="mini-bar black" [style.--width]="printer.inkLevels.black + '%'"></div>
                  <small>K: {{ printer.inkLevels.black }}%</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <ng-template #noPrinters>
        <div class="no-data">
          <p>No printers found</p>
          <button pButton pRipple class="btn-add-printer" routerLink="/printers">
            + Add Your First Printer
          </button>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Detailed Printer Dialog -->
  <p-dialog 
    [(visible)]="displayDetailDialog" 
    [header]="selectedPrinter ? selectedPrinter.name : 'Printer Details'" 
    [modal]="true" 
    [style]="{width: '50vw'}"
    [draggable]="false" 
    [resizable]="false">
    
    <div *ngIf="selectedPrinter && selectedPrinter.detailedInfo" class="printer-detail-content">
      
      <p-accordion [multiple]="true">
        <!-- 1. Printer Information (Expanded by default) -->
        <p-accordionTab header="Printer Information" [selected]="true">
          <div class="detail-grid">
            <div class="detail-item">
              <label>Product Name</label>
              <span>{{ selectedPrinter.detailedInfo.productName }}</span>
            </div>
            <div class="detail-item">
              <label>Printer Name</label>
              <span>{{ selectedPrinter.detailedInfo.printerName }}</span>
            </div>
            <div class="detail-item">
              <label>Model Number</label>
              <span>{{ selectedPrinter.detailedInfo.modelNumber }}</span>
            </div>
            <div class="detail-item">
              <label>Serial Number</label>
              <span>{{ selectedPrinter.detailedInfo.serialNumber }}</span>
            </div>
            <div class="detail-item">
              <label>Engine Cycles</label>
              <span>{{ selectedPrinter.detailedInfo.engineCycles | number }}</span>
            </div>
          </div>
        </p-accordionTab>
    
        <!-- 2. Memory Printer -->
        <p-accordionTab header="Memory Printer">
          <div class="detail-grid">
            <div class="detail-item">
              <label>On Board Memory</label>
              <span>{{ selectedPrinter.detailedInfo.memory?.onBoard }}</span>
            </div>
            <div class="detail-item">
              <label>Total Usable RAM</label>
              <span>{{ selectedPrinter.detailedInfo.memory?.totalUsable }}</span>
            </div>
          </div>
        </p-accordionTab>
    
        <!-- 3. Event Log -->
        <p-accordionTab header="Event Log">
          <div class="detail-grid">
            <div class="detail-item">
              <label>Entries in Use</label>
              <span>{{ selectedPrinter.detailedInfo.eventLog?.entriesInUse }}</span>
            </div>
            <div class="detail-item">
              <label>Max Entries</label>
              <span>{{ selectedPrinter.detailedInfo.eventLog?.maxEntries }}</span>
            </div>
          </div>
        </p-accordionTab>
    
        <!-- 4. Paper Trays and Options -->
        <p-accordionTab header="Paper Trays and Options">
           <div class="detail-grid">
            <div class="detail-item">
              <label>Default Paper Size</label>
              <span>{{ selectedPrinter.detailedInfo.trays?.defaultPaperSize }}</span>
            </div>
             <div class="detail-item">
              <label>Tray 1 Size</label>
              <span>{{ selectedPrinter.detailedInfo.trays?.tray1Size }}</span>
            </div>
             <div class="detail-item">
              <label>Tray 1 Type</label>
              <span>{{ selectedPrinter.detailedInfo.trays?.tray1Type }}</span>
            </div>
             <div class="detail-item">
              <label>Tray 2 Size</label>
              <span>{{ selectedPrinter.detailedInfo.trays?.tray2Size }}</span>
            </div>
             <div class="detail-item">
              <label>Tray 2 Type</label>
              <span>{{ selectedPrinter.detailedInfo.trays?.tray2Type }}</span>
            </div>
          </div>
        </p-accordionTab>
    
        <!-- 5. Ink/Toner Information -->
        <p-accordionTab [header]="(selectedPrinter?.printerType === 'inkjet') ? 'Ink Tank Information' : 'Cartridge Information'">
          <div class="detail-grid">
            <div class="detail-item">
              <label>Supply Level</label>
              <span [ngClass]="{'status-warning': selectedPrinter!.detailedInfo.cartridge?.supplyLevel === 'Low'}">
                {{ selectedPrinter!.detailedInfo.cartridge?.supplyLevel }}
              </span>
            </div>
            <div class="detail-item" *ngIf="selectedPrinter?.printerType === 'inkjet'">
              <label>Ink Tank Serial</label>
              <span>{{ selectedPrinter!.detailedInfo.cartridge?.serialNumber }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedPrinter?.printerType === 'laser'">
              <label>Cartridge Serial</label>
              <span>{{ selectedPrinter!.detailedInfo.cartridge?.serialNumber }}</span>
            </div>
            <div class="detail-item">
              <label>Pages Printed</label>
              <span>{{ selectedPrinter!.detailedInfo.cartridge?.pagesPrinted | number }}</span>
            </div>
             <div class="detail-item" *ngIf="selectedPrinter?.printerType === 'inkjet'">
              <label>Tank Install Date</label>
              <span>{{ selectedPrinter!.detailedInfo.cartridge?.firstInstallDate }}</span>
            </div>
             <div class="detail-item" *ngIf="selectedPrinter?.printerType === 'laser'">
              <label>Cartridge Install Date</label>
              <span>{{ selectedPrinter!.detailedInfo.cartridge?.firstInstallDate }}</span>
            </div>
             <div class="detail-item">
              <label>Last Used Date</label>
              <span>{{ selectedPrinter!.detailedInfo.cartridge?.lastUsedDate }}</span>
            </div>
          </div>
        </p-accordionTab>
      </p-accordion>
    </div>
  </p-dialog>
</div>